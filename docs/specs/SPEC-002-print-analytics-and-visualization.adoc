= SPEC-002: Print Analytics and Visualization System
:sectnums:
:toc:

== Background

As users accumulate more 3D print data, trends and inefficiencies become difficult to identify manually. This analytics and visualization module will empower users to:

- Track cost evolution over time
- Compare slicer settings (e.g. layer height, infill) against cost/performance
- Identify opportunities for cost optimization
- Present printing performance and cost data to clients or internal stakeholders

== Requirements

=== Must Have
- Persist cost and metadata for all parsed prints
- Generate time-series charts of total cost over time
- Summarize total print cost by:
  - Project folder
  - Printer profile
  - Filament type

=== Should Have
- Interactive visualizations (line, pie, bar charts)
- Compare prints across slicing variables
- Export raw cost datasets as CSV

=== Could Have
- Detect cost outliers or efficiency anomalies
- Suggest setting optimizations (e.g. speed vs. layer height tradeoff)
- Visualize energy vs. material cost proportions

=== Wonâ€™t Have (initially)
- Machine learning-based failure prediction
- Real-time slicer integration

== Method

=== Data Model Extension

Extend `PrintProject` and/or `ParsedGcode` with:

[source,csharp]
----
public class PrintAnalyticsRecord
{
    public Guid Id { get; set; }
    public DateTime PrintedOn { get; set; }
    public string ProjectName { get; set; }
    public string PrinterProfileId { get; set; }
    public string MaterialProfileId { get; set; }
    public float TotalCost { get; set; }
    public float MaterialCost { get; set; }
    public float ElectricityCost { get; set; }
    public float DepreciationCost { get; set; }
    public float PrintTimeHours { get; set; }

    // Optional: saved slicing metadata
    public float LayerHeight { get; set; }
    public float InfillPercent { get; set; }
    public float AverageSpeed { get; set; }
}
----

=== Backend Aggregations

- `/analytics/cost-over-time`
- `/analytics/cost-by-printer`
- `/analytics/cost-by-filament`
- `/analytics/settings-comparison`

Use LINQ + EF Core to group and aggregate data in SQL.

=== Frontend Visualization

Use Chart.js or ngx-charts in Angular to create:

- Line chart (cost over time)
- Pie chart (cost breakdown by type or project)
- Bar chart (comparison by profile or slicer setting)

== Implementation

=== Step 1: Analytics DB Setup
- Create `PrintAnalyticsRecord` table
- Automatically save records after every cost calculation

=== Step 2: API Endpoints
- Implement analytics aggregation endpoints
- Add filtering: date ranges, printer/material/profile

=== Step 3: Frontend Dashboard
- Angular component to display charts
- Add dropdown filters and range selectors

=== Step 4: Export Support
- Allow CSV download for any dataset or breakdown

== Milestones

1. Analytics DB + ingestion
2. Cost over time view
3. Cost breakdown by printer and filament
4. Export to CSV
5. Slicer setting comparison dashboard

== Gathering Results

- Confirm DB performance on 1000+ records
- Validate data accuracy against input cost calculations
- Collect user feedback on which visualizations drive action
- Prioritize follow-ups based on usage and insights generated
